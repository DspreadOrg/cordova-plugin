<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" href="css/index.css">
</head>

<body>
<h2 style="text-align:center">Dspread</h2>
<div>
    <button onclick="scanQPos2Mode()" class="ButtonStyle">scan</button>
    <button onclick="dotrade()" class="ButtonStyle">start trade</button>
    <button onclick="disConnectBT()" class="ButtonStyle">disconnect</button>
    <button onclick="updateEMVConfigureByXml()" class="ButtonStyle">updateEMVConfigure</button>
</div>
<div  id="tablediv" class="layui-table-body layui-table-main" style="height:300px;margin-top:10px;" >
    <table class="layui-table" lay-skin="line" style="overflow:auto; margin-top:10px; width:100%; text-align:left; border-collapse:separate; border-spacing:0px 10px;" id="bluTable">
            <colgroup>
                <col width="150">
                <col width="150">
                <col width="200">
                <col>
            </colgroup>
            <thead>
            <tr>
                <th>Bluetooth Name</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
</div>
<textarea id="posResult" style="overflow:scroll; overflow-x:hidden; height:350px;width:100%; margin-top: 10px;" ></textarea>

<script type="text/javascript">
    var tbody = document.querySelector('tbody');
    var tabled = document.getElementById("tablediv");
    var txtresult = document.getElementById("posResult");
    txtresult.style.display="none";
    function addrow(str){
         console.log("refresh list" + str);
         var tr = document.createElement('tr');
         var td1 = document.createElement('td');
         td1.innerHTML = str.split(' ')[0];
         tr.append(td1);
         tbody.append(tr);
         tr.onclick=function(){//on click of select
             console.log("click " + str);
             posresult("bluetooth connecting");
             cordova.plugins.dspread_pos_plugin.connectBluetoothDevice(function(message){
                console.log("success: " +message);
                posresult(message);
             },function(message){
                console.log("fail: " +message);
                posresult(message);
             },true, str);
          }
      }

       function posresult(text){//display the pos status
        tabled.style.display='none';
        txtresult.style.display='block';
        txtresult.value = text;
       }


      function onReturnCustomConfigResult(str){
        tabled.style.display='none';
        txtresult.style.display='block';
        txtresult.value = str;
      }

    //   var bt = document.getElementsBytagname("button")[0];
    //   bt.addEventListener("click", function(){
    //     alert(1)
    //   })

        function scanQPos2Mode(){
            tabled.style.display='block';
            txtresult.style.display='none';
            console.log("scanQPos2Mode");
            cordova.plugins.dspread_pos_plugin.scanQPos2Mode(function(message){
              console.log("success: " +message);
              addrow(message);
            },function(message){
               console.log("fail: " +message);
               posresult(message);
            });
        }

        function disConnectBT(){
            cordova.plugins.dspread_pos_plugin.disconnectBT(function(message){
                console.log("success: " +message);
                posresult(message);
            },function(message){
                console.log("fail: " +message);
                posresult(message);
            });
        }

        function updateEMVConfigureByXml(){
           cordova.plugins.dspread_pos_plugin.updateEMVConfigByXml(function(message){
               console.log("success: " +message);
               posresult(message);
           },function(message){
               console.log("fail: " +message);
               posresult(message);
           });
         }

        function dotrade(){
            console.log("dotrade");
            cordova.plugins.dspread_pos_plugin.doTrade(function(message){
                console.log("success: " +message);
                posresult(message);
                if(message == "onRequestSetAmount"){
                   inputAmount();
                }
            },function(message){
                console.log("fail: " +message);
                posresult(message);
            },['20']);
        }

       function inputAmount(){
         console.log("inputAmount");
         var confirmtd=prompt("please input amount","12")
         console.log("input amount success:"+confirmtd);
         if(confirmtd){
          cordova.plugins.dspread_pos_plugin.setAmount(function(message){
            console.log("scanQPos2Mode->success: " + message);
            this.posresult(message);
          },function(message){
            console.log("scanQPos2Mode->fail: " + fail);
            this.posresult(message);
           },confirmtd,0,"0156",0);
    }
}

        </script>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js">
</script>
</body>
</html>
